<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Netflix Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { background: #141414; color: white; font-family: 'Kanit', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: rgba(0,0,0,0.9); padding: 30px; border-radius: 10px; width: 350px; border: 1px solid #333; }
        h2 { color: #E50914; text-align: center; }
        select, input { width: 100%; padding: 12px; margin-top: 10px; background: #333; border: none; color: white; border-radius: 5px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; background: #E50914; border: none; color: white; font-weight: bold; margin-top: 20px; cursor: pointer; border-radius: 5px; }
        .info { background: #222; padding: 15px; margin-top: 15px; border-radius: 5px; display: none; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ADMIN PANEL</h2>
        <input type="password" id="pass" placeholder="Password">
        <select id="userSel" onchange="showInfo()">
            <option value="">-- LOADING NAMES... --</option>
        </select>
        
        <div id="info" class="info">
            <div>เดือนนี้: <span id="txtAmt">0</span></div>
            <div>ค้างชำระ: <span id="txtBal" style="color:#E50914">0</span></div>
        </div>

        <input type="number" id="payIn" placeholder="Amount to pay">
        <button class="btn" onclick="sendData()">CONFIRM PAYMENT</button>
        <p id="st" style="text-align:center; font-size:12px; color: grey;"></p>
    </div>

<script>
    const url = 'https://script.google.com/macros/s/AKfycbxQHFzt7U21SDZ05aDWy3hqZVaR6BPrvuEwnsLh8eU6DE72meJatoksMpAdudU46KEUJg/exec';
    let users = [];

    // Force load data
    fetch(url)
        .then(res => res.json())
        .then(data => {
            users = data;
            const sel = document.getElementById('userSel');
            sel.innerHTML = '<option value="">-- SELECT USER --</option>';
            data.forEach(u => {
                let opt = document.createElement('option');
                opt.value = u.name;
                opt.textContent = u.name;
                sel.appendChild(opt);
            });
            document.getElementById('st').innerText = "Loaded: " + data.length + " users";
        })
        .catch(err => {
            document.getElementById('st').innerText = "CORS BLOCK: Open the /exec link in a new tab first, then refresh this page.";
            console.error(err);
        });

    function showInfo() {
        const u = users.find(x => x.name === document.getElementById('userSel').value);
        if(u) {
            document.getElementById('txtAmt').innerText = u.amount.toFixed(2);
            document.getElementById('txtBal').innerText = u.balance.toFixed(2);
            document.getElementById('payIn').value = (u.amount + u.balance).toFixed(2);
            document.getElementById('info').style.display = 'block';
        }
    }

    function sendData() {
        const name = document.getElementById('userSel').value;
        const amt = document.getElementById('payIn').value;
        const pass = document.getElementById('pass').value;
        if(!name || !amt || !pass) return alert("Fill everything");
        
        document.getElementById('st').innerText = "Sending...";
        fetch(`${url}?action=admin_confirm&password=${encodeURIComponent(pass)}&name=${encodeURIComponent(name)}&pay_amount=${amt}`)
            .then(r => r.text())
            .then(t => {
                if(t === "Success") { alert("DONE!"); location.reload(); }
                else alert(t);
            });
    }
</script>
</body>
</html>
